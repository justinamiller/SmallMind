name: Golden Output Tests

on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  golden-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '10.0.x'
    
    - name: Restore dependencies
      run: dotnet restore SmallMind.sln
    
    - name: Build (Release)
      run: dotnet build SmallMind.sln --configuration Release --no-restore
    
    - name: Run Golden Output Tests
      run: dotnet test SmallMind.sln --configuration Release --no-build --filter "Category=GoldenOutput" --logger "console;verbosity=detailed"
    
    - name: Run Unit Tests
      run: dotnet test SmallMind.sln --configuration Release --no-build --filter "Category=UnitTest" --logger "console;verbosity=normal"
      continue-on-error: true  # Don't fail the build if unit tests fail (golden tests are priority)

  integration-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    # Only run on schedule or manual trigger to avoid downloading large models in every PR
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'schedule'
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '10.0.x'
    
    - name: Restore dependencies
      run: dotnet restore SmallMind.sln
    
    - name: Build (Release)
      run: dotnet build SmallMind.sln --configuration Release --no-restore
    
    - name: Run Integration Tests
      run: dotnet test tests/SmallMind.IntegrationTests --configuration Release --no-build --logger "console;verbosity=detailed"
