#!/bin/bash
# Multi-Architecture Benchmark Result Consolidator
# Usage: ./consolidate-bench-results.sh <results-dir>

set -e

RESULTS_DIR="${1:-bench/results}"
OUTPUT_FILE="CONSOLIDATED_BENCHMARK_RESULTS.md"

echo "Consolidating benchmark results from: $RESULTS_DIR"
echo "Output file: $OUTPUT_FILE"

# Start consolidated report
cat > "$OUTPUT_FILE" << 'EOF'
# SmallMind Consolidated Multi-Architecture Benchmark Results

**Generated**: $(date -u +"%Y-%m-%d %H:%M UTC")
**Repository**: justinamiller/SmallMind

## Summary

This report consolidates benchmark results from multiple CPU architectures.

---

EOF

# Find all markdown result files
echo "Searching for benchmark result files..."
RESULT_FILES=$(find "$RESULTS_DIR" -name "*.md" -type f 2>/dev/null || true)

if [ -z "$RESULT_FILES" ]; then
    echo "No benchmark result files found in $RESULTS_DIR"
    echo "## No Results Found" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE"
    echo "No benchmark result files were found. Please run benchmarks first." >> "$OUTPUT_FILE"
    exit 0
fi

# Process each result file
COUNT=0
for FILE in $RESULT_FILES; do
    echo "Processing: $(basename $FILE)"
    
    # Extract architecture from filename (format: timestamp_gitsha_arch_model.md)
    FILENAME=$(basename "$FILE")
    ARCH=$(echo "$FILENAME" | cut -d'_' -f3)
    
    echo "" >> "$OUTPUT_FILE"
    echo "## Architecture: $ARCH" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE"
    
    # Append the file content
    cat "$FILE" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE"
    echo "---" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE"
    
    COUNT=$((COUNT + 1))
done

echo "" >> "$OUTPUT_FILE"
echo "## Summary" >> "$OUTPUT_FILE"
echo "" >> "$OUTPUT_FILE"
echo "Consolidated $COUNT benchmark result(s) from different architectures." >> "$OUTPUT_FILE"
echo "" >> "$OUTPUT_FILE"
echo "*Generated by SmallMind Multi-Architecture Benchmark Consolidator*" >> "$OUTPUT_FILE"

echo ""
echo "âœ… Consolidation complete!"
echo "   Results: $COUNT architecture(s)"
echo "   Output: $OUTPUT_FILE"
echo ""
echo "To view: cat $OUTPUT_FILE"
